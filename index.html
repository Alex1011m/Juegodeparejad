<!DOCTYPE html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego √çntimo - Modo Trivia</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n de Tailwind para el modo oscuro -->
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos base del App (Trivia) */
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle, #fce7f3 0%, #d8b4fe 100%);
        }
        .dark body {
            background: #111827;
        }
        .text-shadow-lg {
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
        }
        .dark .text-shadow-lg {
            text-shadow: 0 0 10px rgba(var(--accent-color-rgb), 0.7), 0 0 20px rgba(var(--accent-color-rgb), 0.5);
        }
        .animate-pulse-slow {
            animation: pulse-slow 3s infinite;
        }
        @keyframes pulse-slow {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }
        .top-bar-container {
            position: absolute;
            top: 1rem;
            right: 1rem;
            left: 1rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 1rem;
            z-index: 10;
        }
        .settings-button, .dark-mode-toggle {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .level-card {
            transition: transform 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .level-card:hover {
            transform: scale(1.05);
            border: 2px solid var(--accent-color);
        }
        .back-button {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .prize-input-container {
            display: none;
        }
        .prize-input-container.active {
            display: block;
        }
        
        /* Estilos espec√≠ficos para el selector de color */
        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s, border 0.1s;
            margin: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .color-swatch-selected {
            border: 4px solid white;
            transform: scale(1.1);
            box-shadow: 0 0 0 2px var(--color-swatch-bg); 
        }
        .color-selector-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex items-center justify-center p-4 transition-colors duration-500" style="--accent-color: #ec4899; --accent-color-rgb: 236, 72, 153;">
    <div class="top-bar-container">
        <!-- BOT√ìN DE REGRESO -->
        <div id="back-button-container" class="hidden">
            <button onclick="goBack()" class="back-button bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </button>
        </div>
        <!-- Contenedor Derecho (Configuraci√≥n, Dark Mode) -->
        <div class="flex items-center gap-4">
            <div onclick="toggleSettingsModal()" class="settings-button bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8h12M4 14v4m0-4a2 2 0 100 4m0-4a2 2 0 110 4m16 0v4m0-4a2 2 0 100 4m0-4a2 2 0 110 4m-6-8h12m-6-8v-2m0 2a2 2 0 100-4m0 4a2 2 0 110-4" />
                </svg>
            </div>
            <div onclick="toggleDarkMode()" class="dark-mode-toggle bg-white dark:bg-gray-800 text-gray-800 dark:text-yellow-400">
                <svg id="moon-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
                </svg>
                <svg id="sun-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2.25a.75.75 0 01.75.75v2.5a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.52 7.52a.75.75 0 011.06-1.06l1.77 1.77a.75.75 0 01-1.06 1.06L7.52 7.52zM3 12a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM7.52 16.48a.75.75 0 01-1.06 1.06l-1.77-1.77a.75.75 0 011.06-1.06l1.77 1.77zM12 18.25a.75.75 0 01-.75.75v2.5a.75.75 0 011.5 0v-2.5a.75.75 0 01-.75-.75zM16.48 16.48a.75.75 0 011.06-1.06l1.77 1.77a.75.75 0 01-1.06 1.06l-1.77-1.77zM18.25 12a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75zM16.48 7.52a.75.75 0 011.06-1.06l1.77 1.77a.75.75 0 01-1.06 1.06l-1.77-1.77z"></path>
                </svg>
            </div>
        </div>
    </div>
    
    <!-- Contenedor Principal del Juego (Trivia App) -->
    <div id="game-container" class="w-full max-w-4xl bg-white dark:bg-gray-800 p-6 md:p-10 rounded-3xl shadow-2xl flex flex-col items-center text-center transition-all duration-500 transform scale-100 animate-pulse-slow">
        
        <!-- Pantalla de inicio -->
        <div id="start-screen" class="space-y-6 w-full">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500 dark:from-fuchsia-400 dark:to-cyan-400 mb-2 text-shadow-lg" id="main-title">Juego para Parejas <span id="heart-icon" class="transition-colors duration-1000">‚ù§Ô∏è</span></h1>
            <p class="text-gray-600 dark:text-gray-400 text-sm" id="developer-note">Desarrollador: PandA</p>
            <p class="text-gray-600 dark:text-gray-400 text-lg" id="game-description">Un juego de trivia y desaf√≠os para descubrir y celebrar su conexi√≥n.</p>
            <div class="space-y-4">
                <input type="text" id="player1-name" placeholder="Nombre del Jugador 1" class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-pink-500 dark:focus:ring-fuchsia-400 transition-all shadow-md" oninput="togglePrizeInput(1)">
                <div id="player1-prize-container" class="prize-input-container">
                    <div class="flex items-center gap-2">
                            <input type="text" id="player1-prize" placeholder="Si gano, quiero que..." class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-pink-500 dark:focus:ring-fuchsia-400 transition-all shadow-md">
                            <button onclick="generatePrizeIdea(1)" class="gemini-button text-xl">‚ú®</button>
                    </div>
                </div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Color de Ficha</label>
                <div id="player1ColorSelector" class="color-selector-grid"></div>

                <input type="text" id="player2-name" placeholder="Nombre del Jugador 2" class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-pink-500 dark:focus:ring-fuchsia-400 transition-all shadow-md" oninput="togglePrizeInput(2)">
                <div id="player2-prize-container" class="prize-input-container">
                    <div class="flex items-center gap-2">
                        <input type="text" id="player2-prize" placeholder="Si gano, quiero que..." class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-pink-500 dark:focus:ring-fuchsia-400 transition-all shadow-md">
                        <button onclick="generatePrizeIdea(2)" class="gemini-button text-xl">‚ú®</button>
                    </div>
                </div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Color de Ficha</label>
                <div id="player2ColorSelector" class="color-selector-grid"></div>
            </div>
            <button onclick="startGame()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-600 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-700 transition-all transform hover:scale-105" id="start-button">Empezar a Jugar ‚ú®</button>
        </div>

        <!-- Pantalla de selecci√≥n de nivel -->
        <div id="level-screen" class="hidden space-y-6 w-full">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100" id="level-title">Elige tu modo de juego</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Modo Conexi√≥n -->
                <div class="level-card bg-pink-400 dark:bg-fuchsia-600 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level1-title">Nivel 1: Conexi√≥n ü•∞</h3>
                        <p class="text-sm mt-2 font-normal" id="level1-desc">Preguntas suaves y divertidas para conocerse mejor y fortalecer su v√≠nculo.</p>
                    </div>
                    <button onclick="selectLevel(1)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-700 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-800 transition-all" id="level1-button">
                        ¬°A jugar!
                    </button>
                </div>

                <!-- Modo Pasi√≥n -->
                <div class="level-card bg-rose-500 dark:bg-violet-600 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level2-title">Nivel 2: Pasi√≥n üî•</h3>
                        <p class="text-sm mt-2 font-normal" id="level2-desc">Suban un poco la temperatura con desaf√≠os y preguntas m√°s √≠ntimas.</p>
                    </div>
                    <button onclick="selectLevel(2)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-rose-600 dark:bg-violet-700 rounded-full shadow-lg hover:bg-rose-700 dark:hover:bg-violet-800 transition-all" id="level2-button">
                        ¬°Vamos!
                    </button>
                </div>
                
                <!-- Modo Aventura -->
                <div class="level-card bg-red-600 dark:bg-cyan-600 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level3-title">Nivel 3: Aventura üòà</h3>
                        <p class="text-sm mt-2 font-normal" id="level3-desc">Lleven las cosas a un nivel atrevido y excitante. ¬°Solo para los valientes!</p>
                    </div>
                    <button onclick="selectLevel(3)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-red-700 dark:bg-cyan-700 rounded-full shadow-lg hover:bg-red-800 dark:hover:bg-cyan-800 transition-all" id="level3-button">
                        ¬°Atr√©vete!
                    </button>
                </div>
                
                <!-- Modo Tablero (Nuevo) -->
                <div class="level-card bg-orange-500 dark:bg-amber-600 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level8-title">Modo Tablero üé≤</h3>
                        <p class="text-sm mt-2 font-normal" id="level8-desc">¬°Juego de mesa! Tira el dado y cae en casillas de Pregunta, Reto o Pareja. Flujo atrevido garantizado.</p>
                    </div>
                    <button onclick="selectLevel(8)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-orange-600 dark:bg-amber-700 rounded-full shadow-lg hover:bg-orange-700 dark:hover:bg-amber-800 transition-all" id="level8-button">
                        ¬°A Mover Ficha!
                    </button>
                </div>
                
                <!-- Modo Variado -->
                <div class="level-card bg-purple-500 dark:bg-indigo-600 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level0-title">Modo Variado üé≤</h3>
                        <p class="text-sm mt-2 font-normal" id="level0-desc">Un mix al azar de todos los niveles. ¬°Nunca sabr√°n qu√© sigue!</p>
                    </div>
                    <button onclick="selectLevel(0)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-purple-600 dark:bg-indigo-700 rounded-full shadow-lg hover:bg-purple-700 dark:hover:bg-indigo-800 transition-all" id="level0-button">
                        ¬°Sorpr√©ndete!
                    </button>
                </div>

                <!-- Modo Progresivo -->
                <div class="level-card bg-teal-500 dark:bg-teal-700 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level6-title">Modo Progresivo üìà</h3>
                        <p class="text-sm mt-2 font-normal" id="level6-desc">El juego empieza suave y se vuelve m√°s atrevido con el tiempo.</p>
                    </div>
                    <button onclick="selectLevel(6)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-teal-600 dark:bg-teal-800 rounded-full shadow-lg hover:bg-teal-700 dark:hover:bg-teal-900 transition-all" id="level6-button">
                        ¬°Avanza!
                    </button>
                </div>

                <!-- Modo Personalizado -->
                <div class="level-card bg-yellow-500 dark:bg-lime-600 text-white p-6 rounded-3xl shadow-xl flex flex-col justify-between transition-all transform hover:scale-105">
                    <div>
                        <h3 class="text-2xl font-bold" id="level7-title">Modo Personalizado ‚úèÔ∏è</h3>
                        <p class="text-sm mt-2 font-normal" id="level7-desc">Creen su propio banco de preguntas y retos para una experiencia √∫nica.</p>
                    </div>
                    <button onclick="selectLevel(7)" class="w-full mt-4 py-3 px-6 text-lg font-semibold text-white bg-yellow-600 dark:bg-lime-700 rounded-full shadow-lg hover:bg-yellow-700 dark:hover:bg-lime-800 transition-all" id="level7-button">
                        ¬°A crear!
                    </button>
                </div>
            </div>
        </div>

        <!-- Pantalla de creaci√≥n de retos -->
        <div id="create-game-screen" class="hidden space-y-6 w-full">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100" id="create-title">Crea tus propias preguntas y retos</h2>
            <div class="space-y-4">
                <textarea id="custom-question-input" placeholder="Escribe tu pregunta o reto aqu√≠..." class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-yellow-500 dark:focus:ring-lime-400 transition-all shadow-md min-h-[150px]"></textarea>
                <button onclick="addCustomQuestion()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-yellow-500 dark:bg-lime-600 rounded-full shadow-lg hover:bg-yellow-600 dark:hover:bg-lime-700 transition-all transform hover:scale-105" id="add-question-button">
                    Agregar a mi juego ‚ú®
                </button>
            </div>
            <button onclick="startCustomGame()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-600 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-700 transition-all transform hover:scale-105" id="play-custom-button">¬°Jugar con mis retos! üéâ</button>
        </div>

        <!-- Pantalla de selecci√≥n de rondas -->
        <div id="rounds-screen" class="hidden space-y-6 w-full">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100" id="rounds-title">¬øCu√°ntas rondas quieren jugar?</h2>
            <div class="space-y-4">
                <select id="total-rounds-select" class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700 dark:bg-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-pink-500 dark:focus:ring-fuchsia-400 transition-all shadow-md">
                    <option value="5" id="option-5-rounds">5 rondas</option>
                    <option value="10" selected id="option-10-rounds">10 rondas</option>
                    <option value="15" id="option-15-rounds">15 rondas</option>
                    <option value="20" id="option-20-rounds">20 rondas</option>
                    <option value="30" id="option-30-rounds">30 rondas</option>
                </select>
            </div>
            <button onclick="selectRounds()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-600 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-700 transition-all transform hover:scale-105" id="start-game-button">¬°Empezar Partida! üéâ</button>
        </div>
        
        <!-- Pantalla de juego TRIVIA -->
        <div id="game-screen" class="hidden space-y-6 w-full">
            <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4">
                <div id="progress-bar" class="bg-pink-600 h-2.5 rounded-full dark:bg-fuchsia-500 transition-all duration-500 ease-in-out" style="width: 0%;"></div>
            </div>
            <div class="flex items-center justify-between w-full mb-4">
                <div class="flex flex-col items-start">
                    <span id="player1-score-display" class="text-sm font-semibold text-gray-500 dark:text-gray-400"></span>
                    <span id="player-turn" class="text-xl font-bold text-gray-700 dark:text-gray-100"></span>
                </div>
                <div class="flex flex-col items-end">
                    <span id="player2-score-display" class="text-sm font-semibold text-gray-500 dark:text-gray-400"></span>
                </div>
            </div>
            <div class="flex items-center justify-center space-x-4 mb-4">
                <p id="round-display" class="text-sm font-semibold text-gray-500 dark:text-gray-400"></p>
                <div id="timer-display" class="w-8 h-8 flex items-center justify-center rounded-full bg-pink-500 dark:bg-fuchsia-600 text-white font-bold shadow-md"></div>
            </div>
            <div id="question-box" class="bg-gray-100 dark:bg-gray-700 p-8 rounded-2xl shadow-inner min-h-[250px] flex items-center justify-center">
                <p id="question-text" class="text-2xl text-gray-800 dark:text-gray-100 font-semibold leading-relaxed"></p>
            </div>
            <div id="action-buttons" class="w-full flex justify-center space-x-4 mt-6">
                <button onclick="addPointAndNext()" class="flex-1 py-4 px-6 text-lg font-semibold text-white bg-green-500 dark:bg-emerald-500 rounded-full shadow-lg hover:bg-green-600 dark:hover:bg-emerald-600 transition-all transform hover:scale-105" id="win-button">
                    ¬°Lo logr√©! üéâ
                </button>
                <button onclick="passWithConsequence()" class="flex-1 py-4 px-6 text-lg font-semibold text-white bg-gray-400 dark:bg-gray-600 rounded-full shadow-lg hover:bg-gray-500 dark:hover:bg-gray-700 transition-all transform hover:scale-105" id="pass-button">
                    Pasar ‚û°Ô∏è
                </button>
            </div>
             <div class="mt-4 flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
                <button onclick="readQuestion()" class="py-2 px-4 text-sm font-semibold text-white bg-blue-500 dark:bg-blue-600 rounded-full shadow-lg hover:bg-blue-600 dark:hover:bg-blue-700 transition-all transform hover:scale-105" id="read-button">Leer Pregunta ‚ú®</button>
                <button onclick="generateQuestionWithGemini()" class="py-2 px-4 text-sm font-semibold text-white bg-purple-500 dark:bg-purple-600 rounded-full shadow-lg hover:bg-purple-600 dark:hover:bg-purple-700 transition-all transform hover:scale-105" id="gemini-question-button">Nueva Pregunta ‚ú®</button>
            </div>
            <button onclick="restartGame()" class="mt-4 text-pink-500 hover:text-pink-700 dark:text-fuchsia-400 dark:hover:text-fuchsia-500 transition-colors" id="restart-button">Reiniciar</button>
        </div>
        
        <!-- Pantalla final -->
        <div id="end-screen" class="hidden space-y-6 w-full">
            <h2 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500 dark:from-fuchsia-400 dark:to-cyan-400 mb-2" id="end-title">¬°Fin del Juego! üèÅ</h2>
            <p id="winner-message" class="text-2xl font-semibold text-gray-800 dark:text-gray-100"></p>
            <p id="final-scores" class="text-xl text-gray-600 dark:text-gray-400"></p>
            <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed mt-4" id="end-message"></p>
            <button onclick="restartGame()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-600 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-700 transition-all transform hover:scale-105" id="play-again-button">Jugar de Nuevo ‚ú®</button>
        </div>

        <!-- Modal de consentimiento -->
        <div id="consent-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-2xl text-center max-w-sm">
                <h3 class="text-3xl font-bold text-red-600 dark:text-cyan-400 mb-4" id="consent-title">¬°Advertencia de Nivel 3!</h3>
                <p class="text-gray-700 dark:text-gray-300 mb-6 text-lg leading-relaxed" id="consent-message">
                    Este nivel contiene retos que exploran la intimidad f√≠sica. Recuerden siempre la importancia del consentimiento mutuo. Si algo no se siente bien, digan 'no' y pasen. ¬°La comunicaci√≥n es la clave!
                </p>
                <button onclick="closeConsentModal()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-red-600 dark:bg-cyan-600 rounded-full shadow-lg hover:bg-red-700 dark:hover:bg-cyan-700 transition-all transform hover:scale-105" id="consent-button">Entendido</button>
            </div>
        </div>
        
        <!-- Modal de configuraci√≥n -->
        <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-2xl text-center max-w-sm">
                <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4" id="settings-title">Configuraci√≥n</h3>
                <p class="text-gray-700 dark:text-gray-300 mb-4" id="theme-label">Elige un color de tema:</p>
                <div id="color-picker" class="flex justify-center space-x-2">
                    <button class="color-picker-button bg-pink-500 active" onclick="setAccentColor('#ec4899', '236, 72, 153', this)"></button>
                    <button class="color-picker-button bg-blue-500" onclick="setAccentColor('#3b82f6', '59, 130, 246', this)"></button>
                    <button class="color-picker-button bg-green-500" onclick="setAccentColor('#22c55e', '34, 197, 94', this)"></button>
                    <button class="color-picker-button bg-purple-500" onclick="setAccentColor('#a855f7', '168, 85, 247', this)"></button>
                    <button class="color-picker-button bg-red-500" onclick="setAccentColor('#ef4444', '239, 68, 68', this)"></button>
                </div>
                <div class="flex items-center justify-center space-x-2 mt-6">
                    <div onclick="toggleDarkMode()" class="dark-mode-toggle bg-white dark:bg-gray-800 text-gray-800 dark:text-yellow-400">
                        <svg id="moon-icon-settings" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
                        </svg>
                        <svg id="sun-icon-settings" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2.25a.75.75 0 01.75.75v2.5a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.52 7.52a.75.75 0 011.06-1.06l1.77 1.77a.75.75 0 01-1.06 1.06L7.52 7.52zM3 12a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM7.52 16.48a.75.75 0 01-1.06 1.06l-1.77-1.77a.75.75 0 011.06-1.06l1.77 1.77zM12 18.25a.75.75 0 01-.75.75v2.5a.75.75 0 011.5 0v-2.5a.75.75 0 01-.75-.75zM16.48 16.48a.75.75 0 011.06-1.06l1.77 1.77a.75.75 0 01-1.06 1.06l-1.77-1.77zM18.25 12a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5a.75.75 0 01-.75-.75zM16.48 7.52a.75.75 0 011.06-1.06l1.77 1.77a.75.75 0 01-1.06 1.06l-1.77-1.77z"></path>
                        </svg>
                    </div>
                </div>
                <button onclick="closeSettingsModal()" class="w-full py-3 px-6 mt-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-600 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-700 transition-all transform hover:scale-105" id="close-settings-button">Cerrar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Preguntas y Retos (Compartido) -->
    <div id="challengeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-content bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full relative" onclick="event.stopPropagation()">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-center text-pink-600"></h2>
            <p id="modalType" class="text-sm font-medium mb-4 text-center text-gray-500"></p>
            <p id="modalContent" class="text-lg mb-6 text-center text-gray-800 font-semibold"></p>
            
            <div class="flex justify-center w-full"> 
                <button id="successChallengeBtn" class="w-3/4 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 rounded-full transition duration-200 shadow-md">
                    ¬°Reto Cumplido!
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de alerta -->
    <div id="alert-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-2xl text-center max-w-sm">
            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4" id="alert-title"></h3>
            <p class="text-gray-700 dark:text-gray-300 mb-6" id="alert-message"></p>
            <button onclick="closeAlertModal()" class="w-full py-3 px-6 text-lg font-semibold text-white bg-pink-500 dark:bg-fuchsia-600 rounded-full shadow-lg hover:bg-pink-600 dark:hover:bg-fuchsia-700 transition-all transform hover:scale-105" id="alert-button"></button>
        </div>
    </div>

    <!-- L√≥gica del Juego (JavaScript) -->
    <script> 
        // =========================================================
        // 0. DECLARACI√ìN DE OBJETOS Y CONSTANTES
        // =========================================================
        const startScreen = document.getElementById('start-screen');
        const levelScreen = document.getElementById('level-screen');
        const roundsScreen = document.getElementById('rounds-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const createGameScreen = document.getElementById('create-game-screen');
        const consentModal = document.getElementById('consent-modal');
        const backButtonContainer = document.getElementById('back-button-container');
        const alertModal = document.getElementById('alert-modal');
        const settingsModal = document.getElementById('settings-modal');
        const challengeModal = document.getElementById('challengeModal');

        const player1NameInput = document.getElementById('player1-name');
        const player2NameInput = document.getElementById('player2-name');
        const player1PrizeInput = document.getElementById('player1-prize');
        const player2PrizeInput = document.getElementById('player2-prize');
        const player1PrizeContainer = document.getElementById('player1-prize-container');
        const player2PrizeContainer = document.getElementById('player2-prize-container');
        const player1ScoreDisplay = document.getElementById('player1-score-display');
        const player2ScoreDisplay = document.getElementById('player2-score-display');
        const playerTurnDisplay = document.getElementById('player-turn');
        const roundDisplay = document.getElementById('round-display');
        const questionText = document.getElementById('question-text');
        const winnerMessage = document.getElementById('winner-message');
        const finalScores = document.getElementById('final-scores');
        const endMessage = document.getElementById('end-message');
        const totalRoundsSelect = document.getElementById('total-rounds-select');
        const timerDisplay = document.getElementById('timer-display');
        const progressBar = document.getElementById('progress-bar');
        const successChallengeBtn = document.getElementById('successChallengeBtn');

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        let player1Name, player2Name, player1Prize, player2Prize;
        let player1Score = 0;
        let player2Score = 0;
        let currentPlayer = 1; 
        let currentRound = 1;
        let totalRounds = 10;
        let currentLevel = 1;
        let timerInterval;
        let timeLeft = 30;
        let usedQuestions = JSON.parse(localStorage.getItem('usedQuestions')) || {};
        let customQuestions = JSON.parse(localStorage.getItem('customQuestions')) || [];
        let allQuestions = [];
        let player1GlobalScore = parseInt(localStorage.getItem('player1GlobalScore')) || 0;
        let player2GlobalScore = parseInt(localStorage.getItem('player2GlobalScore')) || 0;
        
        // --- CONSTANTES DE COLOR ---
        const BOARD_COLOR_PALETTE = ['#EF4444', '#EC4899', '#A855F7', '#3B82F6', '#14B8A6', '#F97316', '#FACC15'];
        let player1SelectedColor = BOARD_COLOR_PALETTE[0]; 
        let player2SelectedColor = BOARD_COLOR_PALETTE[2]; 


        // HARDCODED STRINGS (Spanish only)
        const STRINGS = {
            title: "Juego para Parejas",
            developer: "Desarrollador: PandA",
            description: "Un juego de trivia y desaf√≠os para descubrir y celebrar su conexi√≥n.",
            startButton: "Empezar a Jugar ‚ú®",
            addQuestionButton: "Agregar a mi juego ‚ú®",
            playCustomButton: "¬°Jugar con mis retos! üéâ",
            levelTitle: "Elige tu modo de juego",
            level1Title: "Nivel 1: Conexi√≥n ü•∞",
            level1Desc: "Preguntas suaves y divertidas para conocerse mejor y fortalecer su v√≠nculo.",
            level1Button: "¬°A jugar!",
            level2Title: "Nivel 2: Pasi√≥n üî•",
            level2Desc: "Suban un poco la temperatura con desaf√≠os y preguntas m√°s √≠ntimas.",
            level2Button: "¬°Vamos!",
            level3Title: "Nivel 3: Aventura üòà",
            level3Desc: "Lleven las cosas a un nivel atrevido y excitante. ¬°Solo para los valientes!",
            level3Button: "¬°Atr√©vete!",
            level8Title: "Modo Tablero üé≤", 
            level8Desc: "¬°Juego de mesa! Tira el dado y cae en casillas de Pregunta, Reto o Pareja. Flujo atrevido garantizado.",
            level8Button: "¬°A Mover Ficha!", 
            level0Title: "Modo Variado üé≤",
            level0Desc: "Un mix al azar de todos los niveles. ¬°Nunca sabr√°n qu√© sigue!",
            level0Button: "¬°Sorpr√©ndete!",
            level4Title: "Modo Solo Preguntas üó£Ô∏è",
            level4Desc: "Un modo centrado en la comunicaci√≥n. Solo recibir√°n preguntas de todos los niveles.",
            level4Button: "¬°A Hablar!",
            level5Title: "Modo Solo Retos ü§∏",
            level5Desc: "¬°Para cuando solo quieren acci√≥n! Retos f√≠sicos y divertidos de todos los niveles.",
            level5Button: "¬°A Retar!",
            level6Title: "Modo Progresivo üìà",
            level6Desc: "El juego empieza suave y se vuelve m√°s atrevido con el tiempo.",
            level6Button: "¬°Avanza!",
            level7Title: "Modo Personalizado ‚úèÔ∏è",
            level7Desc: "Creen su propio banco de preguntas y retos para una experiencia √∫nica.",
            level7Button: "¬°A crear!",
            roundsTitle: "¬øCu√°ntas rondas quieren jugar?",
            roundsOption: (r) => `${r} rondas`,
            startGameButton: "¬°Empezar Partida! üéâ",
            playerPlaceholder: "Nombre del Jugador ",
            prizePlaceholder: "Si gano, quiero que...",
            winButton: "¬°Lo logr√©! üéâ",
            passButton: "Pasar ‚û°Ô∏è",
            restartButton: "Reiniciar",
            endTitle: "¬°Fin del Juego! üèÅ",
            playAgainButton: "Jugar de Nuevo ‚ú®",
            playerTurn: (p) => `Turno de ${p}`,
            roundDisplay: (c, t) => `Ronda ${c} de ${t}`,
            finalScoreMessage: (p1, s1, p2, s2) => `Puntuaciones finales: ${p1}: ${s1}, ${p2}: ${s2}`,
            winMessage: (w, prize) => `${w} es el ganador! Ahora ${w} puede pedir: "${prize}".`,
            drawMessage: "¬°Es un empate! ¬°Ambos deben cumplir un deseo del otro!",
            noWinnerMessage: "Nadie ha ganado. ¬°Ambos deben hacer un deseo para el otro!",
            timeout: "¬°Se acab√≥ el tiempo!",
            consentTitle: "¬°Advertencia de Nivel 3!",
            consentMessage: "Este nivel contiene retos que exploran la intimidad f√≠sica. Recuerden siempre la importancia del consentimiento mutuo. Si algo no se siente bien, digan 'no' y pasen. ¬°La comunicaci√≥n es la clave!",
            consentButton: "Entendido",
            outOfQuestions: "¬°Se han agotado las preguntas! Reinicia el juego o elige un modo diferente.",
            alertTitle: "Error",
            alertNames: "Por favor, ingresa los nombres de ambos jugadores.",
            alertQuestions: "Por favor, agrega al menos 5 preguntas o retos para comenzar el modo personalizado.",
            settingsTitle: "Configuraci√≥n",
            themeLabel: "Elige un color de tema:",
            closeSettingsButton: "Cerrar",
        };

        // CHALLENGES DATA (Compartido con el modo tablero)
        const CHALLENGES = {
            1: [
                "¬øCu√°l es el recuerdo m√°s gracioso que tienen juntos?", "Si pudieran viajar a cualquier lugar del mundo ahora mismo, ¬øa d√≥nde ir√≠an?", "Si tuvieras que describir su risa con una palabra, ¬øcu√°l ser√≠a?", "¬øCu√°l es una canci√≥n que les recuerda el uno al otro?", "¬øQu√© superpoder elegir√≠an tener juntos?", "Si pudieran pasar un d√≠a sin responsabilidades, ¬øqu√© har√≠an?", "¬øCu√°l es el mejor regalo que le has dado?", "¬øCu√°l es el mejor consejo que les han dado sobre el amor?", "¬øQu√© les hizo darse cuenta de que quer√≠an estar juntos?", "¬øQu√© es algo que has aprendido de tu pareja?", "¬øCu√°l es una meta que les gustar√≠a lograr juntos en los pr√≥ximos cinco a√±os?", "¬øCu√°l es el h√°bito m√°s adorable de tu pareja?", "¬øQu√© es algo que tu pareja hace que te hace sentir seguro/a?", "¬øCu√°l es un logro del que se sienten orgullosos como pareja?", "Si pudieran revivir un d√≠a de su relaci√≥n, ¬øcu√°l elegir√≠an?", "¬øQu√© es lo que m√°s extra√±an hacer que hac√≠an cuando empezaron a salir?", "¬øQu√© los hace sentir m√°s conectados emocionalmente?", "¬øCu√°l es su broma interna favorita?", "¬øQu√© han aprendido el uno del otro sobre el amor?", "¬øQu√© es algo que te sorprende de tu pareja incluso hoy en d√≠a?", "¬øCu√°l es la forma m√°s simple de hacerte feliz?", "¬øQu√© es algo que admiras profundamente de tu pareja?", "Dense un abrazo largo y c√°lido.", "M√≠rate a los ojos durante 30 segundos sin decir nada.", "Escribe algo bonito en la mano de tu pareja con tu dedo."
            ],
            2: [
                "Describan el momento m√°s rom√°ntico que han compartido.", "¬øQu√© tipo de caricias te gustan?", "Nombren una fantas√≠a que les gustar√≠a cumplir juntos.", "¬øCu√°l es su lugar favorito para besarse?", "Dale un masaje en los hombros a tu pareja durante un minuto.", "¬øCu√°l es la parte del cuerpo de tu pareja que m√°s te atrae?", "Describan su cita ideal para un d√≠a lluvioso.", "¬øQu√© los hace sentir m√°s amados y deseados?", "B√©sale en la parte del cuerpo que m√°s te gusta.", "¬øQu√© los hace sentir m√°s sensuales y confiados?", "Acaricia el cabello de tu pareja mientras le dices algo que te encanta de su personalidad.", "¬øCu√°l es su canci√≥n m√°s sensual para bailar lento?", "Describan con tres palabras c√≥mo se sienten cuando se besan.", "Nombren una fantas√≠a no sexual que les gustar√≠a vivir juntos.", "¬øQu√© es lo que m√°s los excita en una cita rom√°ntica?", "Dense un beso que comience lento y se vuelva m√°s apasionado.", "¬øCu√°l es el gesto m√°s rom√°ntico que has hecho por tu pareja?", "Si tuvieran que elegir un sabor para su pasi√≥n, ¬øcu√°l ser√≠a?", "Dale a tu pareja una caricia en la mano que se sienta como un beso.", "Besa la espalda de tu pareja mientras le susurras algo que te gustar√≠a hacerle.", "Masajea los pies de tu pareja durante dos minutos mientras le hablas sobre lo que te atrae de ella.", "¬øCu√°l es tu fantas√≠a de rol play menos sexual pero m√°s sensual?", "Escribe un mensaje sensual en la espalda de tu pareja con tu dedo.", "Dale un beso largo y apasionado a tu pareja sin usar las manos.", "¬øCu√°l es la forma en que m√°s te gusta que te toquen?", "Describan una fantas√≠a que les gustar√≠a cumplir si el tiempo y el lugar no fueran un problema."
            ],
            3: [
                "Describe un lugar inesperado donde les gustar√≠a tener una cita atrevida.", "¬øCu√°l ha sido la fantas√≠a m√°s loca que han tenido?", "Besa el cuello de tu pareja de forma muy sensual.", "¬øQu√© juguete sexual te gustar√≠a usar en pareja?", "Describe una posici√≥n en la que quieras probar.", "Cu√©ntale una fantas√≠a er√≥tica que tengas con tu pareja y c√≥mo te gustar√≠a que fuera.", "Besa cada dedo de los pies de tu pareja.", "Besa cada parte del cuerpo de tu pareja que no le hayas besado antes.", "H√°blale a tu pareja con la voz m√°s sensual que tengas y descr√≠bele algo que te excita de ella.", "Jueguen a 'verdad o reto' pero solo con preguntas y desaf√≠os picantes.", "Dale un beso a tu pareja en el ombligo, subiendo y bajando.", "Dile a tu pareja qu√© es lo que m√°s te gusta de sus gemidos.", "Besa a tu pareja desde el cuello hasta el pecho de forma lenta.", "Haz que tu pareja gima de placer sin tocarla.", "B√©sense apasionadamente con las manos de ambos atadas.", "Dale a tu pareja una 'mordida de amor' en un lugar inesperado.", "T√°pale los ojos a tu pareja y dale besos en diferentes partes del cuerpo para que adivine d√≥nde est√°.", "Desaf√≠ale a tu pareja a un juego de cartas, pero con una apuesta picante.", "Describan qu√© es lo que les atrajo de su pareja en la primera cita.", "Si tuvieran que elegir a una pareja de cine para representarlos, ¬øqui√©nes ser√≠an?", "¬øCu√°l es el recuerdo m√°s √≠ntimo que guardan de su relaci√≥n?", "¬øQu√© los hace sentir m√°s conectados con su pareja en un nivel profundo?", "Dale un masaje en la espalda a tu pareja mientras le susurras algo que te gusta de ella.", "¬øCu√°l es un logro del que te sientes orgulloso como pareja?", "Dale a tu pareja un masaje er√≥tico con los ojos vendados.", "Sus√∫rrale al o√≠do a tu pareja algo que te gustar√≠a hacer con ella en la cama.", "Describe la parte de tu cuerpo que m√°s te gusta que te besen.", "Dale un beso en el abdomen a tu pareja y sube lentamente hasta sus labios.", "B√©sale los dedos de las manos a tu pareja uno por uno, de forma lenta y sensual."
            ],
            couple: [
                { type: 'reto', text: '¬°Reto en Pareja! Dense un beso largo y apasionado, terminando con un susurro √≠ntimo al o√≠do.', level: 'Pareja' },
                { type: 'reto', text: '¬°Reto en Pareja! Ambos deben quitarse una prenda de vestir al mismo tiempo, sin usar las manos.', level: 'Pareja' },
                { type: 'pregunta', text: '¬°Pregunta en Pareja! Ambos deben nombrar su fantas√≠a sexual M√ÅS PROHIBIDA y discutir c√≥mo podr√≠an acercarse a ella.', level: 'Pareja' },
                { type: 'reto', text: '¬°Reto en Pareja! Tomen 60 segundos para besarse mientras exploran una zona sensible de su pareja con una mano.', level: 'Pareja' },
                { type: 'pregunta', text: '¬°Pregunta en Pareja! ¬øCu√°l fue el momento exacto en que te sentiste m√°s atra√≠do/a sexualmente por m√≠?', level: 'Pareja' }
            ]
        };

        // =========================================================
        // 4. FUNCIONES DE INTERACCI√ìN (GLOBALES)
        // =========================================================
        
        function playClickSound() {
            if (audioContext.state === 'suspended') { audioContext.resume(); }
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime); 
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.05);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.05);
        }

        function showAlertModal(title, message) {
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-message').textContent = message;
            document.getElementById('alert-modal').classList.remove('hidden');
        }

        function showScreen(screenId) {
            const screens = [startScreen, levelScreen, roundsScreen, gameScreen, endScreen, createGameScreen, consentModal, alertModal, settingsModal];
            screens.forEach(screen => {
                if (screen) screen.classList.add('hidden');
            });
            
            const requestedScreen = document.getElementById(screenId);
            if (requestedScreen) requestedScreen.classList.remove('hidden');
            
            const isTriviaSubScreen = ['rounds-screen', 'game-screen', 'create-game-screen'].includes(screenId);

            if (isTriviaSubScreen) {
                backButtonContainer.classList.remove('hidden');
            } else {
                backButtonContainer.classList.add('hidden');
            }
        }

        function loadGame() { showScreen('start-screen'); }
        
        function togglePrizeInput(playerNum) { 
            const nameInput = document.getElementById(`player${playerNum}-name`);
            const prizeContainer = document.getElementById(`player${playerNum}-prize-container`);
            if (nameInput.value.trim() !== '') {
                prizeContainer.classList.add('active');
            } else {
                prizeContainer.classList.remove('active');
                if (document.getElementById(`player${playerNum}-prize`)) {
                    document.getElementById(`player${playerNum}-prize`).value = '';
                }
            }
        }
        
        function saveGame() {
            const gameState = {
                player1Name,
                player2Name,
                player1Prize,
                player2Prize,
                player1Score,
                player2Score,
                currentPlayer,
                currentRound,
                totalRounds,
                currentLevel,
                usedQuestions
            };
            // C√≥digo simplificado de guardado
            // localStorage.setItem('gameState', JSON.stringify(gameState));
        }

        function startGame() {
            player1Name = player1NameInput.value.trim();
            player2Name = player2NameInput.value.trim();
            player1Prize = player1PrizeInput.value.trim() || STRINGS.prizePlaceholder;
            player2Prize = player2PrizeInput.value.trim() || STRINGS.prizePlaceholder;
            
            if (player1Name && player2Name) {
                playClickSound();
                showScreen('level-screen');
                saveGame();
            } else {
                showAlertModal(STRINGS.alertTitle, STRINGS.alertNames);
            }
        }
        
        function selectLevel(level) {
            currentLevel = level;
            playClickSound();

            if (currentLevel === 8) { // MODO TABLERO: Redirigir a la URL del archivo de tablero
                // Guardamos los datos de configuraci√≥n en localStorage para que el otro archivo los lea
                const configData = {
                    player1Name, player2Name, player1Prize, player2Prize,
                    player1SelectedColor, player2SelectedColor, CHALLENGES,
                    player1GlobalScore, player2GlobalScore
                };
                localStorage.setItem('boardGameConfig', JSON.stringify(configData));

                // Redirigir (o abrir en nueva ventana para simular el cambio de p√°gina)
                window.location.href = 'juego_tablero.html';
                return;
            }

            // L√≥gica para modos TRIVIA
            if (currentLevel === 7) {
                showScreen('create-game-screen');
            } else if (currentLevel === 3 || currentLevel === 0 || currentLevel === 6) {
                showConsentModal();
            } else {
                showScreen('rounds-screen');
            }
            saveGame();
        }

        function showConsentModal() {
            consentModal.classList.remove('hidden');
        }

        function closeConsentModal() {
            playClickSound();
            consentModal.classList.add('hidden');
            showScreen('rounds-screen');
        }

        function addCustomQuestion() { 
            const question = document.getElementById('custom-question-input').value.trim();
            if (question) {
                customQuestions.push(question);
                localStorage.setItem('customQuestions', JSON.stringify(customQuestions));
                document.getElementById('custom-question-input').value = '';
                showAlertModal('√âxito', '¬°Pregunta o reto agregado!');
            }
        }
        function startCustomGame() { 
            if (customQuestions.length < 5) {
                showAlertModal(STRINGS.alertTitle, STRINGS.alertQuestions);
            } else {
                showScreen('rounds-screen');
            }
        }
        
        function selectRounds() {
            playClickSound();
            totalRounds = parseInt(totalRoundsSelect.value);
            currentRound = 1;
            player1Score = 0;
            player2Score = 0;
            currentPlayer = 1;
            usedQuestions = {};
            showScreen('game-screen');
            displayQuestion();
            saveGame();
        }

        function goBack() { 
            playClickSound();
            clearInterval(timerInterval);
            
            if (!levelScreen.classList.contains('hidden')) {
                showScreen('start-screen');
            } else if (!roundsScreen.classList.contains('hidden')) {
                showScreen('level-screen');
            } else if (!gameScreen.classList.contains('hidden')) {
                showScreen('rounds-screen');
            } else if (!createGameScreen.classList.contains('hidden')) {
                showScreen('level-screen');
            }
        }
        
        function closeAlertModal() { document.getElementById('alert-modal').classList.add('hidden'); }
        function toggleSettingsModal() { document.getElementById('settings-modal').classList.toggle('hidden'); }
        function closeSettingsModal() { document.getElementById('settings-modal').classList.add('hidden'); }
        
        function restartGame() {
            playClickSound();
            clearInterval(timerInterval);
            showScreen('start-screen');
            localStorage.removeItem('gameState');
            location.reload(); 
        }
        
        // --- L√ìGICA DE TRIVIA ---

        function displayQuestion() {
            if (currentRound > totalRounds) {
                showScreen('end-screen');
                displayEndScreen();
                return;
            }

            let questionList = [];
            let currentPool = [];

            // Modo 1, 2, 3: Nivel fijo. Modo 7: Personalizado.
            if (currentLevel >= 1 && currentLevel <= 3) {
                currentPool = CHALLENGES[currentLevel];
            } else if (currentLevel === 7) {
                currentPool = customQuestions;
            } else if (currentLevel === 0) { // Modo Variado: Mezcla todos
                currentPool = [...CHALLENGES[1], ...CHALLENGES[2], ...CHALLENGES[3]];
            } else if (currentLevel === 4) { // Solo Preguntas: Filtra solo preguntas
                currentPool = [...CHALLENGES[1], ...CHALLENGES[2], ...CHALLENGES[3]].filter(q => q.includes('?'));
            } else if (currentLevel === 5) { // Solo Retos: Filtra solo retos
                currentPool = [...CHALLENGES[1], ...CHALLENGES[2], ...CHALLENGES[3]].filter(q => !q.includes('?'));
            } else if (currentLevel === 6) { // Modo Progresivo
                let level = 1;
                if (currentRound > totalRounds / 3 * 2) level = 3;
                else if (currentRound > totalRounds / 3) level = 2;
                currentPool = CHALLENGES[level];
            }

            // Filtrar preguntas ya usadas
            const availableQuestions = currentPool.filter((q) => !usedQuestions[q]);
            questionList = availableQuestions.length === 0 ? currentPool : availableQuestions;

            if (questionList.length === 0) {
                questionText.textContent = STRINGS.outOfQuestions;
                document.getElementById('action-buttons').classList.add('hidden');
                return;
            }
            document.getElementById('action-buttons').classList.remove('hidden');
            
            const randomIndex = Math.floor(Math.random() * questionList.length);
            const question = questionList[randomIndex];
            questionText.textContent = question;
            
            usedQuestions[question] = true;
            
            updateScoresDisplay();
            updateTurnDisplay();
            updateRoundDisplay();
            startTimer();
            saveGame();
        }

        async function generatePrizeIdea(playerNum) { /* L√≥gica Gemini */ }
        async function generateQuestionWithGemini() { /* L√≥gica Gemini */ }
        function readQuestion() { /* L√≥gica TTS */ }

        function nextQuestion() {
            playClickSound();
            clearInterval(timerInterval);
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            if (currentPlayer === 1) {
                currentRound++;
            }
            displayQuestion();
        }

        function passWithConsequence() {
            playClickSound();
            if (currentPlayer === 1) {
                player1Score = Math.max(0, player1Score - 1);
            } else {
                player2Score = Math.max(0, player2Score - 1);
            }
            nextQuestion();
        }

        function addPointAndNext() {
            playClickSound();
            let points = 1;
            if (currentLevel === 2) points = 2;
            if (currentLevel === 3) points = 3;
            if (currentLevel === 6) {
                if (currentRound > totalRounds / 3 * 2) points = 3;
                else if (currentRound > totalRounds / 3) points = 2;
                else points = 1;
            }

            if (currentPlayer === 1) {
                player1Score += points;
            } else {
                player2Score += points;
            }
            nextQuestion();
        }

        function updateScoresDisplay() {
            player1ScoreDisplay.textContent = `${player1Name}: ${player1Score}`;
            player2ScoreDisplay.textContent = `${player2Name}: ${player2Score}`;
            
            const progress = (currentRound - 1) / totalRounds * 100;
            progressBar.style.width = `${progress}%`;
        }

        function updateTurnDisplay() {
            const player = currentPlayer === 1 ? player1Name : player2Name;
            playerTurnDisplay.textContent = STRINGS.playerTurn(player);
        }

        function updateRoundDisplay() {
            roundDisplay.textContent = STRINGS.roundDisplay(currentRound, totalRounds);
        }

        function displayEndScreen() {
            let message;
            let winnerPrize = '';

            if (player1Score > player2Score) {
                winnerPrize = player1Prize;
                message = STRINGS.winMessage(player1Name, winnerPrize);
                player1GlobalScore++;
            } else if (player2Score > player1Score) {
                winnerPrize = player2Prize;
                message = STRINGS.winMessage(player2Name, winnerPrize);
                player2GlobalScore++;
            } else if (player1Score === 0 && player2Score === 0) {
                message = STRINGS.noWinnerMessage;
            } else {
                message = STRINGS.drawMessage;
                player1GlobalScore++;
                player2GlobalScore++;
            }

            winnerMessage.textContent = message;
            finalScores.textContent = STRINGS.finalScoreMessage(player1Name, player1Score, player2Name, player2Score) + " | Puntuaci√≥n Global: " + player1Name + ": " + player1GlobalScore + ", " + player2Name + ": " + player2GlobalScore;
            endMessage.textContent = STRINGS.endMessage;
            localStorage.setItem('player1GlobalScore', player1GlobalScore);
            localStorage.setItem('player2GlobalScore', player2GlobalScore);
            saveGame();
        }
        
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 30;
            timerDisplay.textContent = timeLeft;
            timerDisplay.classList.remove('text-red-500', 'dark:text-red-400');

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 5) {
                    // vibrate([200, 100, 200]); // Desactivado por restricciones
                    timerDisplay.classList.add('text-red-500', 'dark:text-red-400');
                } else {
                    timerDisplay.classList.remove('text-red-500', 'dark:text-red-400');
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    questionText.textContent = STRINGS.timeout;
                    // vibrate([500, 50, 500]); // Desactivado por restricciones
                    setTimeout(() => {
                        nextQuestion();
                    }, 2000);
                }
            }, 1000);
        }
        
        // --- L√ìGICA DE COLORES ---

        function getHoverColor(hex) {
            let r = parseInt(hex.substring(1, 3), 16), g = parseInt(hex.substring(3, 5), 16), b = parseInt(hex.substring(5, 7), 16);
            r = Math.max(0, r - Math.round(r * 0.1));
            g = Math.max(0, g - Math.round(g * 0.1));
            b = Math.max(0, b - Math.round(b * 0.1));
            const toHex = (c) => c.toString(16).padStart(2, '0');
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }
        
        function createColorSelector(containerElement, playerId) {
            if (!containerElement) return; 
            containerElement.innerHTML = '';
            
            BOARD_COLOR_PALETTE.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.style.setProperty('--color-swatch-bg', color);
                swatch.dataset.color = color;
                
                swatch.onclick = () => selectColor(playerId, color, containerElement);
                containerElement.appendChild(swatch);
            });

            const defaultColor = playerId === 0 ? BOARD_COLOR_PALETTE[0] : BOARD_COLOR_PALETTE[2];
            selectColor(playerId, defaultColor, containerElement);
        }

        function selectColor(playerId, color, container) {
            container.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.classList.remove('color-swatch-selected');
            });

            const selectedSwatch = container.querySelector(`[data-color="${color}"]`);
            if (selectedSwatch) { selectedSwatch.classList.add('color-swatch-selected'); }

            if (playerId === 0) { player1SelectedColor = color; } else { player2SelectedColor = color; }
        }


        // =========================================================
        // 5. INICIALIZACI√ìN FINAL
        // =========================================================
        document.addEventListener('DOMContentLoaded', () => {
            createColorSelector(document.getElementById('player1ColorSelector'), 0);
            createColorSelector(document.getElementById('player2ColorSelector'), 1);

            if (localStorage.getItem('fromBoard')) {
                localStorage.removeItem('fromBoard');
                const config = localStorage.getItem('boardGameConfig');
                if (config) {
                    const data = JSON.parse(config);
                    player1NameInput.value = data.player1Name;
                    player2NameInput.value = data.player2Name;
                    player1PrizeInput.value = data.player1Prize;
                    player2PrizeInput.value = data.player2Prize;
                    player1SelectedColor = data.player1SelectedColor;
                    player2SelectedColor = data.player2SelectedColor;
                    selectColor(0, player1SelectedColor, document.getElementById('player1ColorSelector'));
                    selectColor(1, player2SelectedColor, document.getElementById('player2ColorSelector'));
                    showScreen('level-screen');
                    return;
                }
            }

            loadGame();
        });
        
    </script>
</body>
</html>
